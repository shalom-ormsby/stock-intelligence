# Stock Intelligence

*Last updated: November 3, 2025 at 9:09 AM*

**A serverless stock analysis platform with LLM-powered insights, multi-factor scoring, and intelligent rate limiting.**

**Version:** 1.0.0-beta.1 (v1.0.2 in development)
**Status:** Production-ready backend, HTML analyzer interface in beta
**Author:** Shalom Ormsby

---

## Overview

Stock Intelligence is a **personal decision-support tool** for equity analysis, built on a serverless TypeScript architecture. It combines real-time market data, sophisticated scoring algorithms, and AI-generated analysis to help you make informed trading decisions ahead of earnings and major market events.

**Design Philosophy:** *Impeccable but simple.* Built for daily stock analyses, not enterprise scale. Clean architecture, production-grade code, minimal complexity.

### What It Does

1. **Analyzes stocks in 18-25 seconds** using 11 FMP API calls + 6 FRED API calls
2. **Generates composite scores** (1.0-5.0 scale) across 6 categories: Technical, Fundamental, Macro, Risk, Sentiment, Sector
3. **Creates AI-generated narratives** with Google Gemini Flash 2.5 ($0.013/analysis, 2,000 tokens)
4. **Tracks historical context** with delta calculations and trend detection
5. **Enforces rate limits** (10 analyses/user/day) with session-based bypass codes
6. **Syncs to Notion databases** for analysis storage and review (v1.0.2) ‚Üí PostgreSQL migration planned (v2.0)

---

## Architecture

### Technology Stack

**Backend:**
- **Platform:** Vercel Serverless Functions (300s timeout, Node.js 18+)
- **Language:** TypeScript 5.3+
- **Runtime:** Node.js serverless environment

**Data Sources:**
- **Financial Modeling Prep (FMP)** - Stock data, fundamentals, technical indicators ($22-29/month)
- **FRED API** - Macroeconomic data (yield curve, VIX, unemployment) (free)
- **Upstash Redis** - Distributed rate limiting state (REST API, serverless-native)

**LLM Integration:**
- **Provider-agnostic abstraction layer** supporting:
  - Google Gemini (Flash 2.5, Flash 1.5) - Primary, $0.013/analysis
  - OpenAI (GPT-4 Turbo, GPT-3.5 Turbo)
  - Anthropic (Claude 3.5 Sonnet, Claude 3 Haiku)
- **Configurable via environment variable** (`LLM_PROVIDER`)
- **50% token reduction** vs. original prompts (6,000 ‚Üí 2,000 tokens)

**Integration:**
- **Notion API** - Database operations (v1.0.2, transitioning to PostgreSQL in v2.0)
- **REST APIs** - All external communication via HTTP

### API Endpoints

| Endpoint | Method | Description | Timeout |
|----------|--------|-------------|---------|
| `/api/health` | GET | Health check (uptime, version) | 10s |
| `/api/analyze` | POST | Stock analysis (full workflow) | 300s |
| `/api/webhook` | POST | Notion webhook handler | 60s |
| `/api/bypass` | GET/POST | Activate bypass code session | 10s |
| `/api/usage` | GET | Check rate limit usage | 10s |
| `/api/api-status` | GET | API monitoring dashboard | 30s |

### Data Flow (v1.0.2)

```
User (WordPress Page)
    ‚Üì POST /api/analyze {ticker, userId}
Vercel Serverless Function
    ‚Üì Check rate limit (Redis)
    ‚Üì Fetch market data (FMP + FRED, 3-5s)
    ‚Üì Calculate scores (1s)
    ‚Üì Query historical analyses (Notion, 2-5s)
    ‚Üì Compute deltas/trends (<1s)
    ‚Üì Generate LLM analysis (Gemini, 10-20s)
    ‚Üì Write to Notion (3 operations, 10-15s)
        ‚Ä¢ Update Stock Analyses page (metrics)
        ‚Ä¢ Create child analysis page (AI content)
        ‚Ä¢ Archive to Stock History
    ‚Üì Return {pageUrl, scores, metadata}
User
    ‚Üí Opens Notion analysis page
```

**Total Latency:** 30-45 seconds (under 60s Vercel Pro timeout)

---

## Key Features

### Multi-Factor Scoring System

Composite score (1.0-5.0) calculated from weighted categories:

| Category | Weight | Metrics Included |
|----------|--------|------------------|
| **Technical** | 30% | RSI, MACD, Bollinger Bands, SMA crossovers, volume trends |
| **Fundamental** | 35% | P/E ratio, EPS growth, revenue growth, profit margins, ROE |
| **Macro** | 20% | Market regime, sector rotation, yield curve, VIX, unemployment |
| **Risk** | 15% | Beta, volatility, drawdown, correlation to market |
| **Sentiment** | - | News sentiment, analyst ratings (unweighted, for context) |
| **Sector** | - | Relative sector performance vs. S&P 500 |

**Recommendations:**
- Strong Buy (4.0+)
- Buy (3.5-3.99)
- Moderate Buy (3.0-3.49)
- Hold (2.5-2.99)
- Moderate Sell (2.0-2.49)
- Sell (1.5-1.99)
- Strong Sell (<1.5)

### LLM-Generated Analysis

7-section narrative generated by Google Gemini Flash 2.5:

1. **Executive Summary** - Buy/Hold/Sell recommendation with confidence level
2. **Technical Analysis** - Chart patterns, momentum indicators, support/resistance
3. **Fundamental Analysis** - Valuation metrics, earnings quality, growth prospects
4. **Risk Assessment** - Downside risks, volatility analysis, worst-case scenarios
5. **Macro Context** - Economic headwinds/tailwinds, sector trends, market regime
6. **Historical Trends** - Score deltas vs. previous analyses, trend direction
7. **Action Items** - Specific recommendations (e.g., "Wait for RSI < 30 before entry")

**Token Optimization:**
- Original prompts: 6,000 tokens ‚Üí 30s generation time
- Optimized prompts: 2,000 tokens ‚Üí 10-15s generation time
- **67% reduction** in tokens, **50% reduction** in latency

### Rate Limiting & Access Control

**User-level quotas:**
- 10 analyses per user per day (resets at midnight UTC)
- Tracked in Upstash Redis (distributed state)
- Graceful degradation (fails open if Redis unavailable)

**Bypass code system:**
- Session-based bypass (one-time code entry)
- Unlimited analyses until midnight UTC
- Stored in Redis with TTL expiry
- Admin bypass via environment variable

**Endpoints:**
- `GET /api/usage` - Check remaining quota (non-consuming)
- `POST /api/bypass` - Activate bypass code session
- `GET /api/bypass?code=XXX` - URL parameter activation

### Performance Optimizations

**v1.0.11 Optimizations (Nov 2-3, 2025):**
- **Sequential deletion** replaced parallel batches to eliminate Notion API conflicts
- **90 blocks deleted in ~18 seconds** (was failing with 504 timeouts)
- **Zero conflict errors** (was 50-93% failure rate with parallelism)
- **Total analysis time:** 30-45 seconds (was timing out at 60+ seconds)

**Key insights:**
- Notion's eventual consistency requires sequential block operations
- Pre-flight delays don't help (conflicts occur during operations)
- Reliability > Performance for write-heavy operations

---

## Quick Start

### Prerequisites

- Node.js 18+ and npm
- Vercel account (Pro plan for 300s timeout)
- API keys: FMP, FRED, Google Gemini, Notion
- Upstash Redis database (free tier works)

### Installation

```bash
# Clone repository
git clone https://github.com/shalomormsby/stock-intelligence.git
cd stock-intelligence

# Install dependencies
npm install

# Copy environment template
cp .env.example .env

# Add your API keys to .env (never commit this file!)
# See SETUP.md for detailed configuration instructions
```

### Local Development

```bash
# Start Vercel dev server (localhost:3000)
npm run dev

# Test analysis endpoint
curl -X POST http://localhost:3000/api/analyze \
  -H "Content-Type: application/json" \
  -d '{"ticker": "AAPL", "userId": "test-user"}'

# Check health
curl http://localhost:3000/api/health
```

### Deployment

```bash
# Install Vercel CLI
npm i -g vercel

# Deploy to production
vercel --prod

# Configure environment variables in Vercel dashboard
# See DEPLOYMENT.md for detailed instructions
```

---

## Documentation

### Essential Reading

- **[ARCHITECTURE.md](ARCHITECTURE.md)** - System design, component structure, data flow diagrams
- **[SETUP.md](SETUP.md)** - Complete setup guide for beta testers and contributors
- **[API.md](API.md)** - API endpoint documentation with examples
- **[DEPLOYMENT.md](DEPLOYMENT.md)** - Deployment checklist and production configuration
- **[ROADMAP.md](ROADMAP.md)** - Current status, completed work, future plans

### Additional Resources

- **[CHANGELOG.md](CHANGELOG.md)** - Version history and release notes
- **[docs/guides/](docs/guides/)** - Implementation guides (Notion setup, rate limiting, etc.)
- **[.github/FILE_ORGANIZATION.md](.github/FILE_ORGANIZATION.md)** - File organization standards

---

## Project Status

**Current Version:** v1.0.0-beta.1

**Completed (v1.0.0):**
- ‚úÖ TypeScript/Vercel serverless architecture
- ‚úÖ Multi-factor scoring engine (~2,500 LOC)
- ‚úÖ FMP + FRED API integration (11 + 6 calls per analysis)
- ‚úÖ Rate limiting system (Upstash Redis)
- ‚úÖ LLM abstraction layer (Google Gemini, OpenAI, Anthropic)
- ‚úÖ Notion database integration (read/write optimizations)
- ‚úÖ Performance optimizations (sequential deletion, conflict resolution)

**In Progress (v1.0.2):**
- ‚è≥ HTML analyzer page (WordPress-hosted, Tailwind CSS + Vanilla JS)
- ‚è≥ Admin dashboard for API monitoring
- ‚è≥ User-facing analyzer interface (ticker input ‚Üí view results)

**Planned (v2.0):**
- üìã Next.js frontend application (responsive, mobile-first)
- üìã PostgreSQL migration (Supabase, 10-15x faster than Notion)
- üìã Trend charts (Recharts, score history over time)
- üìã Portfolio tracking and watchlists

**Timeline:**
- v1.0.2 completion: ~3-5 hours remaining
- v2.0 migration: 25-35 hours (months 2-3)

See [ROADMAP.md](ROADMAP.md) for detailed sprint planning.

---

## Cost Structure

**Monthly Operating Costs (v1.0.2):**

| Service | Cost | Usage |
|---------|------|-------|
| Vercel Pro | $20/month | 300s timeout, unlimited invocations |
| FMP API | $22-29/month | Stock data, fundamentals, technical indicators |
| Google Gemini | $40/month | 3,000 analyses (@ $0.013 each) |
| FRED API | Free | Macroeconomic data |
| Notion | Free | Database storage (v1.0.2 only) |
| Upstash Redis | Free | Rate limiting state (under free tier limits) |
| **Total** | **$82-89/month** | For personal use (up to 3,000 analyses/month) |

**v2.0 Upgrade (PostgreSQL):**
- Add Supabase: $0-25/month (free tier ‚Üí Pro as needed)
- Total: $102-134/month (10-15x faster database, unlimited scale)

---

## License

**Business Source License 1.1**

### You CAN:
- ‚úÖ Use for personal, educational, and non-commercial purposes
- ‚úÖ View and study the source code
- ‚úÖ Modify for your own personal use
- ‚úÖ Fork on GitHub for non-commercial projects

### You CANNOT:
- ‚ùå Provide commercial stock analysis services
- ‚ùå Sell this software or derivative works
- ‚ùå Compete with the original author's offerings

### Change Date: October 23, 2029
After this date, the software becomes available under the **MIT License** (fully open source).

**Commercial licensing:** Contact shalom.ormsby@gmail.com

See [LICENSE](LICENSE) file for full terms.

---

## Support & Contact

**Author:** Shalom Ormsby
**Email:** shalom.ormsby@gmail.com
**Repository:** [github.com/shalomormsby/stock-intelligence](https://github.com/shalomormsby/stock-intelligence)

**For issues:**
- Check documentation in [docs/](docs/) folder first
- Review [CHANGELOG.md](CHANGELOG.md) for recent changes
- Open an issue on GitHub (when repository is public)

**For bugs:**
- Include: ticker, error message, expected vs. actual behavior
- Check [ROADMAP.md](ROADMAP.md) to see if issue is already known
- Provide Vercel function logs if possible

---

## Contributing

This is currently a personal project, but contributions are welcome for:
- Bug reports and fixes
- Documentation improvements
- Performance optimizations
- Feature suggestions (see [ROADMAP.md](ROADMAP.md) first)

**Before contributing:**
1. Read [ARCHITECTURE.md](ARCHITECTURE.md) to understand system design
2. Review [.github/FILE_ORGANIZATION.md](.github/FILE_ORGANIZATION.md) for file organization standards
3. Check [ROADMAP.md](ROADMAP.md) to avoid duplicating planned work

---

## Acknowledgments

Built with:
- [Vercel](https://vercel.com) - Serverless platform
- [Financial Modeling Prep](https://financialmodelingprep.com) - Market data
- [FRED](https://fred.stlouisfed.org) - Economic data
- [Google Gemini](https://ai.google.dev) - LLM analysis generation
- [Notion](https://notion.so) - Database integration (v1.0.2)
- [Upstash](https://upstash.com) - Redis rate limiting

---

*For legacy v0.2.x Python documentation, see [docs/legacy/README_v0.2.x.md](docs/legacy/README_v0.2.x.md)*
